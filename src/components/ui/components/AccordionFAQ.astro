---
import ArrowDownIcon from "../../../assets/icons/arrow-down-icon.svg";
import ArrowUpIcon from "../../../assets/icons/arrow-up-icon.svg";
import TextContent from "../elements/TextContent.astro";
import TagContent from "../elements/TagContent.astro";
import AlertContent from "../elements/AlertContent.astro";
import ListContent from "../elements/ListContent.astro";
import StepsContent from "../elements/StepsContent.astro";
import type { FAQItem } from '../../../data/general-questions.ts';

const { questions } = Astro.props;
---

<style>
    .accordion {
        border-bottom: 1px solid var(--background-02);
        cursor: pointer;
    }

    .accordion:last-child {
        border: none;
        cursor: pointer;
    }

    .accordion-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0px;
        user-select: none;
    }

    .accordion-header .title {
        display: flex;
        align-items: center;
        gap: 16px;

        font-family: Satoshi;
        color: var(--base-white);
        font-size: 20px;
        font-style: normal;
        font-weight: 500;
        line-height: 130%;
    }

    .accordion-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
        
        color: var(--base-grey);
        font-family: Satoshi;
        font-size: 18px;
        font-style: normal;
        font-weight: 400;
        line-height: 130%;
    }

    .accordion.active .accordion-header .title {
        color: transparent;
        text-shadow: 0px 0px 12px rgba(255, 255, 255, 0.32);
        background: linear-gradient(90deg, #E90063 0%, #FF8820 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
</style>

<div id="accordion-container">
  {
    questions.map((question: FAQItem, index: number) => (
        <div class="accordion">
            <div class="accordion-header" data-index={index}>
                <h5 class="title">
                    {question.question}
                </h5>
                <img 
                    src={ArrowDownIcon.src} 
                    class="toggle-icon" 
                    alt="Open/Closed Icon" 
                    data-open={ArrowDownIcon.src}
                    data-close={ArrowUpIcon.src}
                />
            </div>
            <div class="accordion-content">
                {
                    question.content.map((item) => {
                        if (item.type === 'text') return <TextContent text={item.value} />
                        if (item.type === 'tag') return <TagContent tag={item.value} icon={item.icon} />
                        if (item.type === 'warning') return <AlertContent alert={item.value} />
                        if (item.type === 'list' && item.values) return <ListContent items={item.values} />
                        if (item.type === 'steps' && item.values) return <StepsContent steps={item.values} />
                        return null
                    })
                }
            </div>
        </div>
    ))
  }
</div>

<script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
        const accordions = document.querySelectorAll(".accordion");

        accordions.forEach((accordion) => {
            const header = accordion.querySelector(".accordion-header");
            const content = accordion.querySelector(".accordion-content");
            const icon = accordion.querySelector(".toggle-icon");

            header.addEventListener("click", () => {
                const isActive = accordion.classList.contains("active");

                // Cerrar todos los acordeones antes de abrir el seleccionado
                accordions.forEach((acc) => {
                    acc.classList.remove("active");
                    acc.querySelector(".accordion-content").style.maxHeight = "0px";
                    acc.querySelector(".toggle-icon").src = acc.querySelector(".toggle-icon").dataset.open;
                });

                // Si no estaba activo, abrirlo
                if (!isActive) {
                    accordion.classList.add("active");
                    content.style.maxHeight = content.scrollHeight + "px";
                    icon.src = icon.dataset.close;
                }
            });
        });
    });
</script>
